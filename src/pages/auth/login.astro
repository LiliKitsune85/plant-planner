---
import { SignInForm } from "@/components/auth/SignInForm";
import { AuthCard } from "@/components/auth/AuthCard";
import AuthLayout from "@/layouts/AuthLayout.astro";

export const prerender = false;

const rawReturnTo = Astro.url.searchParams.get("returnTo");
const returnTo = rawReturnTo && rawReturnTo.startsWith("/") ? rawReturnTo : "/calendar";

const {
  data: { user },
} = await Astro.locals.supabase.auth.getUser();

if (user) {
  return Astro.redirect(returnTo);
}

const footerLinks = [
  {
    href: `/auth/register?returnTo=${encodeURIComponent(returnTo)}`,
    label: "Nie masz jeszcze konta?",
    description: "Załóż konto i zacznij planować pielęgnację roślin.",
  },
  {
    href: "/auth/forgot-password",
    label: "Zapomniałeś hasła?",
    description: "Wyślemy instrukcję odzyskiwania dostępu.",
  },
];
---

<AuthLayout
  title="Plant Planner — logowanie"
  heading="Witaj ponownie w Plant Planner"
  description="Zaloguj się, aby zarządzać domową dżunglą i otrzymywać przypomnienia o podlewaniu."
  eyebrow="Panel użytkownika"
>
  <AuthCard
    title="Zaloguj się"
    description="Podaj e-mail i hasło ustawione podczas rejestracji."
    footerLinks={footerLinks}
  >
    <SignInForm client:load returnTo={returnTo} />
  </AuthCard>
</AuthLayout>
