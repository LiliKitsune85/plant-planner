---
import AppShell from "../../layouts/AppShell.astro";
import { CalendarMonthView } from "../../components/calendar/month/CalendarMonthView";
import {
  normalizeCalendarStatusFilter,
  isValidCalendarMonthString,
} from "../../lib/services/calendar/month-view-model";
import type { CalendarTaskStatusFilter } from "../../lib/services/calendar/types";

export const prerender = false;

const monthParam = Astro.params.month ?? "";
const statusParam = Astro.url.searchParams.get("status") ?? undefined;
const status = normalizeCalendarStatusFilter(statusParam as CalendarTaskStatusFilter | undefined);
const isValidMonth = isValidCalendarMonthString(monthParam);
const safeMonth = monthParam ?? "";
const pageTitle = isValidMonth ? `Kalendarz — ${safeMonth}` : "Kalendarz — niepoprawny miesiąc";
---

<AppShell title={pageTitle} section="calendar">
  <CalendarMonthView month={safeMonth} status={status} client:load />
</AppShell>
